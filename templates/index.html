<!DOCTYPE html>
<html>
<head>
    <title>Flask API Application</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        h1, h2 {
            color: #333;
        }
        #output, #plot-img {
            margin: 20px auto;
            width: 80%;
        }
        .button, label {
            display: inline-block;
            margin: 10px;
            padding: 15px 30px;
            font-size: 16px;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            width: 250px;  /* Ensuring all buttons have the same width */
        }
        .button {
            background-color: #4CAF50;
        }
        .button:hover {
            background-color: #45a049;
        }
        label {
            background-color: #ff0000;
        }
        label:hover {
            background-color: #cc0000;
        }
        input[type="file"] {
            display: none;
        }
        .file-name {
            display: inline-block;
            margin-left: 10px;
            vertical-align: middle;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>Fortune-telling on cards</h1>
    <h2>It is possible to find out the age of the client based on information about his card expenses thanks to Sberbank who prepared the task based on real banking transactions. When improving its products, the bank uses information about users, including age. It helps to make personalized products that meet the real needs of customers.</h2>
    <h1>Accurate predictions</h1>
    <h2>Here we predict which age group the bank client falls into based on information about the bank's expenses. Train training data for feature building and model training, and test test data for validating algorithms are given. This is specially prepared and anonymized information on which models can be trained, while maintaining the complete security of real customer data. The solution to the problem is the prediction of algorithms based on test data.</h2>
    <h2>You can access the information about the dataset and the predicted result by clicking on the appropriate button. Enjoy!</h2>
    
    <p>Please upload your CSV files for age prediction:</p>
    <form id="upload-form" enctype="multipart/form-data">
        <label for="transactions_train">Choose Transaction Train File</label>
        <input type="file" name="transactions_train.csv" id="transactions_train" required>
        <span id="transactions_train_name" class="file-name"></span><br>

        <label for="train_target">Choose Train Target File</label>
        <input type="file" name="train_target.csv" id="train_target" required>
        <span id="train_target_name" class="file-name"></span><br>

        <label for="transactions_test">Choose Transaction Test File</label>
        <input type="file" name="transactions_test.csv" id="transactions_test" required>
        <span id="transactions_test_name" class="file-name"></span><br>

        <label for="test_id">Choose Test File</label>
        <input type="file" name="test.csv" id="test_id" required>
        <span id="test_id_name" class="file-name"></span><br>

        <button type="submit" class="button">Upload Files</button>
    </form>

    <button id="shapes-btn" class="button" style="display:none;">Show Data Shapes</button>
    <button id="heads-btn" class="button" style="display:none;">Show Data Heads</button>
    <button id="run-model-btn" class="button" style="display:none;">Run Model and Show Plot</button>
    <div id="output"></div>
    <img id="plot-img" src="" alt="Plot Image" style="display:none;">

    <script>
        $(document).ready(function() {
            $('#upload-form input[type="file"]').change(function() {
                const fileName = $(this).prop('files')[0].name;
                const labelId = '#' + $(this).attr('id') + '_name';
                $(labelId).text(fileName);
            });

            $('#upload-form').on('submit', function(e) {
                e.preventDefault();
                var formData = new FormData(this);
                $.ajax({
                    url: '/upload',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(data) {
                        alert(data.message);
                        $('#shapes-btn').show();
                        $('#heads-btn').show();
                        $('#run-model-btn').show();
                    }
                });
            });

            $('#shapes-btn').click(function() {
                $.get('/data_shapes', function(data) {
                    $('#output').html('<pre>' + JSON.stringify(data, null, 2) + '</pre>');
                });
            });

            $('#heads-btn').click(function() {
                $.get('/data_heads', function(data) {
                    let headsHtml = '<p>client_id is a unique identifier of the client, corresponding to the client_id field of the transactions.</p>' +
                                    '<p>trans_date is the date of the transaction.</p>' +
                                    '<p>small_group - purchase category.</p>' +
                                    '<p>amount_rur is the transaction amount.</p>' +
                                    '<p>bins - the target variable to predict, this is the customer\'s age category.</p>';
                    for (const [key, value] of Object.entries(data)) {
                        headsHtml += '<h3>' + key + '</h3>' + value;
                    }
                    $('#output').html(headsHtml);
                });
            });

            $('#run-model-btn').click(function() {
                $.get('/run_model', function() {
                    $('#plot-img').attr('src', 'static/plot.png').show();
                    $('#output').html('<p>Customer\'s age category is represented by each bin. The higher the bin, the more frequency of transactions the age group makes.</p>');
                });
            });
        });
    </script>
    <h2>Thank you for using our app. We hope it meets your expectations and provides valuable insights!</h2>
</body>
</html>